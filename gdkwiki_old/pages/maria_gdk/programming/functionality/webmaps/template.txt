====== WMS in Map template ======

Using an xml template script, it is possible to have web map layers initiated at application startup. So far, not all web maps client properties are accessible through template tags. But the ones most commonly used are. This section will present the the various tags available for template declarations.

Consult the [[maria_gdk:maps:config:templates&#compositemaptemplate|general documentation]] for specifying MariaGDK multiservice map packages in terms of composite map templates, and the surrounding mechanisms.

As for web maps, consider the following example:
<code xml>
<compositemaptemplate description="WebMaps">
  
  
  <!-- This is a web maps layer accessing the publicly available Virtual Earth service -->
  
  <layer type="MapLayer" name="Virtual Earth">
    <opacity>1</opacity>
    <brightness>0</brightness>
    <gamma>1</gamma>
    <contrast>0</contrast>
    <grayscale>false</grayscale>
    <minscalevisible>100</minscalevisible>
    <maxscalevisible>256000000000</maxscalevisible>
    <datasource>
      <mapsignature>WMS</mapsignature>
      <maptype>WmsMap</maptype>
      <usecache>true</usecache>
    </datasource>
    <visible>true</visible>
    <property key="serviceType" value="VirtualEarth"/>
    <property key="veMapStyle" value="Aerial"/>
  </layer>
  
  <!-- This is an OGCWMS layer accessing the publicly available maps from Kartverket  -->
  
  <layer type="MapLayer" name="WMS Norway">
    <opacity>1</opacity>
    <brightness>0</brightness>
    <gamma>1</gamma>
    <contrast>0</contrast>
    <grayscale>false</grayscale>
    <compression>Any</compression>
    <minscalevisible>1</minscalevisible>
    <maxscalevisible>128000000</maxscalevisible>
    <datasource>
      <mapsignature>wms</mapsignature>
      <maptype>WmsMap</maptype>
      <hostcategory>DontCare</hostcategory>
      <showlabels>false</showlabels>
      <layergroupfilter>Hoydelag</layergroupfilter>
      <layergroupfilter>fjellskygge</layergroupfilter>
      <layergroupfilter>Tekst</layergroupfilter>
      <usecache>false</usecache>
    </datasource>
    <visible>true</visible>
    <property key="serviceType" value="OGCWMSMap" />
    <property key="ogcUri" value="http://openwms.statkart.no/skwms1/wms.topo2?" />
    <property key="ogcCrs" value="EPSG:32632" />
  </layer>

  
  <!-- This is a web maps layer accessing the publicly available Open Street service -->

  <layer type="MapLayer" name="Open Street">
    <opacity>1</opacity>
    <brightness>0</brightness>
    <gamma>1</gamma>
    <contrast>0</contrast>
    <grayscale>false</grayscale>
    <minscalevisible>100</minscalevisible>
    <maxscalevisible>256000000000</maxscalevisible>
    <datasource>
      <mapsignature>WMS</mapsignature>
      <maptype>WmsMap</maptype>
      <usecache>true</usecache>
    </datasource>
    <visible>true</visible>
    <property key="serviceType" value="OpenstreetMap"/>
    <property key="osMapStyle" value="Standard"/>
  </layer>
  
  <!-- This is a web maps layer accessing an OGCWMTS service -->
  
  <layer type="MapLayer" name="Norge Toporaster wmts">
    <opacity>1</opacity>
    <brightness>0</brightness>
    <gamma>1</gamma>
    <contrast>0</contrast>
    <grayscale>false</grayscale>
    <minscalevisible>100</minscalevisible>
    <maxscalevisible>256000000000</maxscalevisible>
    <datasource>
      <mapsignature>WMS</mapsignature>
      <maptype>WmsMap</maptype>
      <usecache>true</usecache>
    </datasource>
    <visible>true</visible>
    <property key="serviceType" value="OGCWMTSMap"/>
    <property key="wmtsLayer" value="toporaster3"/>
    <property key="ogcUri" value="http://opencache.statkart.no/gatekeeper/gk/gk.open_wmts"/>
    <property key="wmtsTileMatrixSet" value="EPSG:900913"/>
  </layer>
  
</compositemaptemplate>
</code>

The ** datasource ** element needs the following subelements:
^ Element tag ^ Value ^ #elements ^ Description ^
|mapsignature | WMS | 1 | Tag used to identify the element as a Web Maps Layer. |
|maptype | WmsMap | 1 | Mandatory maptype key. |
|layergroupfilter | <valid layer name>. Used for WMS only.| 1 .. no limit | Knowledge of available layers and their names requires that the server capabilities document has been downloaded and looked into - at least once upon a time. If omitted or empty, nothing will be asked for, and nothing shown. |

Notice the ** maptype ** tag. The value //must// be ** WmsMap **.

The ** property ** elements are mandatory, and further specify the kind of web map service:

^ Element with key^ Value ^ # elements ^ Description ^
|serviceType | OpenstreetMap, VirtualEarth, OGCWMSMap, OGCWMTSMap | 1 | Mandatory service type identifier. The value must be one of those listed. |

Other ** property ** elements depend on the serviceType value.

===== VirtualEarth =====

For ** VirtualEarth ** the following ** property ** element is valid:

^ Element with key^ Value ^ # elements ^ Description ^
|veMapStyle | (see below) | 0-1 | Optional map style. |

veMapStyle:
^ Value ^ Description ^
| Aerial | Satellite and aerial view - ortophoto, without additional features. Default. |
| Road | Rastermap with Emphasis on roads.  |
| Hillshade | Rastermap with emphasis on hillshades. |
| Hybrid | Satellite and aerial view, with roads and placenames. |

===== OpenstreetMap =====

For ** OpenstreetMap ** the following ** property ** element is valid:
^ Element with key^ Value ^ # elements ^ Description ^
|osMapStyle | (see below) | 0-1 | Optional map style. |

osMapStyle:
^ Value ^ Description ^
| Standard | A standard openstreet map, without particular features. Default. |
| OpenCycle | With bicycle paths highlighted. |
| OpenCycleTransport | Emphasis on public transport, such as train lines and tubes. |
| MapQuest | Emphasis on highways. |
| MapQuestOpenAerial | Satellite  images. |

===== OGCWMSMap =====

For ** OGCWMSMap ** the following ** property ** elements are valid:
^ Element with key^ Value ^ # elements ^ Description ^
|ogcUri | Service url | 1 | Mandatory. |
|ogcVersion | A valid OGC version identifier. | 1 | Optional value for a perferred version. |
|ogcCrs | A valid crs code. | 1 | Optional code for a preferred coordinate system. |


===== OGCWMTSMap =====

For ** OGCWMTSMap ** the following ** property ** subelements are valid:
^ Element with key^ Value ^ # elements ^ Description ^
|ogcUri | Service url | 1 | Mandatory. |
|ogcVersion | A valid OGC version identifier. | 1 | Optional value for a perferred version. |
|wmtsLayer | <valid layer name> | 1 | A valid layer name just as it appears in the server capabilities section.|
|wmtsTileMatrixSet | <valid tile matrix set> | 1 | A valid tile matrix set identifier chosen among the ones supported for the selected layer, as stated by the server capabilities document. |

Notice the difference between OGCWMS and OGCWMTS with respect to layer specifications. The reason being that with OGCWMTS one asks for tiles from already drawn maps - all with a fixed content. It makes little sense to ask for more than one layer at a time. With OGCWMS though, a layer name may refer to a single (vector data) theme or denote a composition of such themes. Hence the order of items in the ** layergroupfilter ** matter.      
































 
























